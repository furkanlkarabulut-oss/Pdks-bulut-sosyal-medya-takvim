<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@pdksbulut Planner</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body { font-family: 'Inter', sans-serif; overflow: hidden; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Past Days Striped Pattern */
        .day-past {
            background-image: repeating-linear-gradient(45deg, transparent, transparent 10px, #f8fafc 10px, #f8fafc 20px);
            opacity: 0.7;
        }

        /* Animations */
        .slide-in-right { animation: slideInRight 0.3s ease-out forwards; }
        .fade-in { animation: fadeIn 0.2s ease-out forwards; }
        .zoom-in { animation: zoomIn 0.2s ease-out forwards; }

        @keyframes slideInRight { from { transform: translateX(100%); } to { transform: translateX(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes zoomIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* Cursor states for panning */
        .cursor-grab { cursor: grab; }
        .cursor-grabbing { cursor: grabbing; }

        /* Hide scrollbar for layout cleanliness */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-white text-slate-900 h-screen flex flex-col">

    <!-- TOP NAVIGATION -->
    <header class="h-16 border-b border-slate-100 bg-white/80 backdrop-blur-md flex items-center justify-between px-6 z-30 sticky top-0 flex-shrink-0">
        <!-- Logo -->
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 text-blue-600">
                <svg viewBox="0 0 24 24" fill="none" class="w-full h-full" stroke="currentColor" stroke-width="0">
                    <path fill="currentColor" d="M17.5,19c-0.3,0-0.5-0.1-0.7-0.2c-0.2-0.2-0.3-0.4-0.3-0.7c0-0.3,0.1-0.5,0.3-0.7c0.2-0.2,0.4-0.3,0.7-0.3 c2.5,0,4.5-2,4.5-4.5c0-2.3-1.8-4.2-4-4.5c-0.4-0.1-0.7-0.4-0.7-0.8C17.2,4.1,14.8,2,12,2C8.6,2,5.8,4.3,5.1,7.5 C5,7.9,4.7,8.2,4.3,8.2C1.9,8.5,0,10.6,0,13c0,2.8,2.2,5,5,5c0.3,0,0.5,0.1,0.7,0.3s0.3,0.4,0.3,0.7c0,0.3-0.1,0.5-0.3,0.7 C5.5,19.9,5.3,20,5,20c-3.9,0-7-3.1-7-7c0-3.3,2.3-6.1,5.5-6.8C4.7,2.6,8.1,0,12,0c3.9,0,7.2,2.5,8.5,6.1c3.1,0.6,5.5,3.4,5.5,6.7 C26,16.4,22.2,20,17.5,19z"/>
                </svg>
            </div>
            <span class="font-bold text-lg tracking-tight">@pdksbulut</span>
        </div>

        <!-- Center Toggle -->
        <div class="absolute left-1/2 transform -translate-x-1/2 bg-slate-100 p-1 rounded-full flex items-center gap-1">
            <button onclick="switchView('calendar')" id="btn-view-calendar" class="flex items-center gap-2 px-6 py-2 rounded-full text-xs font-bold transition-all bg-white shadow-sm text-slate-900">
                <i data-lucide="calendar" class="w-3.5 h-3.5"></i> Takvim
            </button>
            <button onclick="switchView('media')" id="btn-view-media" class="flex items-center gap-2 px-6 py-2 rounded-full text-xs font-bold transition-all text-slate-500 hover:text-slate-700">
                <i data-lucide="image" class="w-3.5 h-3.5"></i> Medya Arşivi
            </button>
        </div>

        <!-- Right Action -->
        <button onclick="openEditor(new Date())" class="bg-black text-white hover:bg-slate-800 transition-colors px-5 py-2.5 rounded-xl text-sm font-semibold flex items-center gap-2 shadow-lg shadow-slate-200">
            <i data-lucide="plus" class="w-4 h-4"></i> Planla
        </button>
    </header>

    <!-- MAIN CONTENT -->
    <main class="flex-1 flex flex-col relative overflow-hidden bg-white">
        
        <!-- CALENDAR VIEW -->
        <div id="view-calendar" class="h-full flex flex-col relative">
            <!-- Calendar Header -->
            <div class="flex items-center justify-between px-8 py-4 bg-white border-b border-slate-100 z-20">
                <div class="flex items-center gap-4">
                    <h2 class="text-2xl font-bold text-slate-900 tracking-tight" id="calendar-month-year">
                        <!-- JS ile dolacak -->
                    </h2>
                    <div class="flex items-center gap-1 bg-slate-100 p-1 rounded-full">
                        <button onclick="changeMonth(-1)" class="w-8 h-8 flex items-center justify-center hover:bg-white rounded-full transition-all text-slate-500"><i data-lucide="chevron-left" class="w-4 h-4"></i></button>
                        <button onclick="changeMonth(1)" class="w-8 h-8 flex items-center justify-center hover:bg-white rounded-full transition-all text-slate-500"><i data-lucide="chevron-right" class="w-4 h-4"></i></button>
                    </div>
                </div>
                <div id="pan-indicator" class="hidden animate-in fade-in flex items-center gap-2 px-3 py-1.5 rounded-full text-[11px] font-semibold bg-blue-600 text-white shadow-lg shadow-blue-200">
                    <i data-lucide="move" class="w-3 h-3"></i> <span>Pan & Switch</span>
                </div>
            </div>

            <!-- Calendar Grid Container -->
            <div id="calendar-container" class="flex-1 overflow-auto p-8 flex flex-col relative select-none pb-60">
                <!-- Weekdays -->
                <div class="grid grid-cols-7 mb-2 min-w-[1000px]">
                    <div class="text-center pb-2 text-[12px] font-bold text-slate-400 uppercase tracking-widest">Pzt</div>
                    <div class="text-center pb-2 text-[12px] font-bold text-slate-400 uppercase tracking-widest">Sal</div>
                    <div class="text-center pb-2 text-[12px] font-bold text-slate-400 uppercase tracking-widest">Çar</div>
                    <div class="text-center pb-2 text-[12px] font-bold text-slate-400 uppercase tracking-widest">Per</div>
                    <div class="text-center pb-2 text-[12px] font-bold text-slate-400 uppercase tracking-widest">Cum</div>
                    <div class="text-center pb-2 text-[12px] font-bold text-slate-400 uppercase tracking-widest">Cmt</div>
                    <div class="text-center pb-2 text-[12px] font-bold text-slate-400 uppercase tracking-widest">Paz</div>
                </div>
                <!-- Days Grid -->
                <div id="calendar-grid" class="grid grid-cols-7 grid-rows-6 min-h-[900px] min-w-[1000px] flex-1 border-t border-l border-slate-200">
                    <!-- JS ile dolacak -->
                </div>
            </div>

            <!-- BOTTOM TIMELINE -->
            <div id="bottom-timeline" class="fixed bottom-0 left-0 right-0 h-52 bg-white/90 backdrop-blur-xl border-t border-slate-200 z-30 transition-all duration-500">
                <!-- Header -->
                <div onclick="toggleTimeline()" class="h-10 flex items-center justify-between px-6 cursor-pointer hover:bg-slate-50 border-b border-slate-100">
                    <div class="flex items-center gap-2 text-slate-500 font-medium text-xs uppercase tracking-wider">
                        <i data-lucide="clock" class="w-3.5 h-3.5 text-blue-600"></i>
                        <span>Yayın Akışı</span>
                        <span id="timeline-count" class="bg-slate-100 text-slate-600 px-2 py-0.5 rounded-full text-[10px] ml-1 font-bold">0</span>
                    </div>
                    <button class="text-slate-400"><i data-lucide="chevron-down" id="timeline-icon" class="w-4 h-4"></i></button>
                </div>
                <!-- Content -->
                <div id="timeline-content" class="p-5 overflow-x-auto whitespace-nowrap h-42">
                    <div id="timeline-scroll-area" class="flex gap-8 items-start h-full">
                        <!-- JS ile dolacak -->
                    </div>
                </div>
            </div>
        </div>

        <!-- MEDIA LIBRARY VIEW -->
        <div id="view-media" class="hidden h-full overflow-y-auto p-8 bg-slate-50/50">
            <h2 class="text-2xl font-bold text-slate-900 flex items-center gap-3 mb-8">
                <div class="p-2 bg-indigo-100 rounded-lg text-indigo-600"><i data-lucide="image" class="w-5 h-5"></i></div>
                Medya Arşivi
            </h2>
            <div id="media-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                <!-- JS ile dolacak -->
            </div>
        </div>

    </main>

    <!-- RIGHT PANEL EDITOR (MODAL) -->
    <div id="editor-overlay" onclick="closeEditor()" class="fixed inset-0 bg-slate-900/20 backdrop-blur-sm z-40 hidden transition-opacity opacity-0"></div>
    <div id="editor-panel" class="fixed right-0 top-0 h-screen w-[450px] bg-white shadow-2xl z-50 transform translate-x-full transition-transform duration-300 flex flex-col font-sans">
        <!-- Header -->
        <div class="p-6 border-b border-slate-100 flex items-center justify-between bg-white sticky top-0 z-20">
            <div>
                <h2 id="editor-title" class="font-bold text-xl text-slate-900 tracking-tight">Yeni Planla</h2>
                <p id="editor-date" class="text-xs text-slate-500 font-medium mt-1">...</p>
            </div>
            <button onclick="closeEditor()" class="p-2 hover:bg-slate-100 rounded-full text-slate-500"><i data-lucide="x" class="w-5 h-5"></i></button>
        </div>
        
        <!-- Form -->
        <form id="post-form" class="flex-1 p-8 space-y-6 overflow-y-auto bg-slate-50/50">
            <input type="hidden" id="edit-post-id">
            
            <!-- Title -->
            <div class="bg-white p-1 rounded-2xl shadow-sm border border-slate-200">
                <div class="flex items-center gap-2 px-3 py-2 border-b border-slate-100">
                    <i data-lucide="type" class="w-3.5 h-3.5 text-indigo-600"></i>
                    <label class="text-xs font-bold text-slate-500 uppercase tracking-wider">Başlık</label>
                </div>
                <input type="text" id="input-title" required placeholder="Gönderi konusu..." class="w-full p-4 text-base font-semibold text-slate-900 outline-none rounded-b-2xl bg-white">
            </div>

            <!-- Platform & Type -->
            <div class="grid grid-cols-1 gap-6">
                <div>
                    <label class="text-xs font-bold text-slate-800 mb-2 block">Hedef Platform</label>
                    <div class="grid grid-cols-4 gap-2">
                        <button type="button" onclick="selectPlatform('instagram')" id="plat-instagram" class="plat-btn p-3 rounded-xl border-2 border-slate-100 bg-white flex flex-col items-center gap-1 hover:bg-slate-50"><i data-lucide="instagram" class="w-4 h-4"></i><span class="text-[10px] font-bold">Insta</span></button>
                        <button type="button" onclick="selectPlatform('linkedin')" id="plat-linkedin" class="plat-btn p-3 rounded-xl border-2 border-slate-100 bg-white flex flex-col items-center gap-1 hover:bg-slate-50"><i data-lucide="linkedin" class="w-4 h-4"></i><span class="text-[10px] font-bold">Linked</span></button>
                        <button type="button" onclick="selectPlatform('twitter')" id="plat-twitter" class="plat-btn p-3 rounded-xl border-2 border-slate-100 bg-white flex flex-col items-center gap-1 hover:bg-slate-50"><i data-lucide="twitter" class="w-4 h-4"></i><span class="text-[10px] font-bold">X</span></button>
                        <button type="button" onclick="selectPlatform('youtube')" id="plat-youtube" class="plat-btn p-3 rounded-xl border-2 border-slate-100 bg-white flex flex-col items-center gap-1 hover:bg-slate-50"><i data-lucide="youtube" class="w-4 h-4"></i><span class="text-[10px] font-bold">YT</span></button>
                    </div>
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-800 mb-2 block">İçerik Formatı</label>
                    <div class="flex gap-2 p-1 bg-slate-200 rounded-xl">
                        <button type="button" onclick="selectType('post')" id="type-post" class="type-btn flex-1 py-2 rounded-lg text-xs font-bold flex items-center justify-center gap-1">Gönderi</button>
                        <button type="button" onclick="selectType('reel')" id="type-reel" class="type-btn flex-1 py-2 rounded-lg text-xs font-bold flex items-center justify-center gap-1">Reels</button>
                        <button type="button" onclick="selectType('story')" id="type-story" class="type-btn flex-1 py-2 rounded-lg text-xs font-bold flex items-center justify-center gap-1">Story</button>
                    </div>
                </div>
            </div>

            <!-- Media -->
            <div onclick="document.getElementById('file-input').click()" id="media-preview-area" class="h-32 border-2 border-dashed border-slate-300 rounded-2xl flex flex-col items-center justify-center cursor-pointer hover:bg-indigo-50/50 hover:border-indigo-300 transition-colors relative overflow-hidden bg-white">
                <input type="file" id="file-input" class="hidden" accept="image/*" onchange="handleFileSelect(this)">
                <div id="media-placeholder" class="text-center">
                    <i data-lucide="upload" class="w-6 h-6 text-slate-400 mx-auto mb-2"></i>
                    <span class="text-xs font-semibold text-slate-500">Görsel Seç</span>
                </div>
                <img id="media-img" class="hidden w-full h-full object-cover absolute inset-0">
                <button type="button" onclick="removeMedia(event)" id="remove-media-btn" class="hidden absolute top-2 right-2 bg-red-500 text-white p-1 rounded-md z-10"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
            </div>

            <!-- Notes -->
            <div class="bg-white rounded-2xl shadow-sm border border-slate-200">
                <div class="flex items-center justify-between px-4 py-2 border-b border-slate-100 bg-slate-50/50">
                    <label class="text-xs font-bold text-slate-500 uppercase tracking-wider">Notlar</label>
                    <button type="button" class="text-[10px] bg-indigo-100 text-indigo-700 px-2 py-1 rounded-full font-bold flex items-center gap-1"><i data-lucide="sparkles" class="w-3 h-3"></i> Oluştur</button>
                </div>
                <textarea id="input-notes" rows="6" class="w-full p-4 text-sm outline-none resize-none bg-white" placeholder="İçerik metni..."></textarea>
            </div>
        </form>

        <!-- Footer -->
        <div class="p-6 border-t border-slate-200 bg-white sticky bottom-0 z-20">
            <button onclick="savePost()" class="w-full bg-slate-900 hover:bg-slate-800 text-white py-4 px-6 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center gap-2 transform active:scale-95 transition-all">
                <i data-lucide="check-circle-2" class="w-5 h-5"></i>
                <span id="save-btn-text">Kaydet</span>
            </button>
        </div>
    </div>

    <!-- POST DETAIL MODAL (Card View) -->
    <div id="post-detail-modal" class="fixed inset-0 z-[60] flex items-center justify-center p-4 hidden">
        <div onclick="closePostDetail()" class="absolute inset-0 bg-slate-900/20 backdrop-blur-sm"></div>
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm relative z-10 overflow-hidden border border-slate-100 zoom-in">
            <!-- Header -->
            <div class="flex items-center justify-between p-5 border-b border-slate-50 bg-slate-50/50">
                <div class="flex items-center gap-2">
                    <span id="detail-platform-badge" class="px-2.5 py-1 rounded-md text-[10px] font-bold tracking-wider uppercase border"></span>
                    <span id="detail-type-badge" class="text-[10px] font-semibold text-slate-400 uppercase bg-white border border-slate-200 px-2 py-1 rounded-md"></span>
                </div>
                <button onclick="closePostDetail()" class="w-8 h-8 hover:bg-slate-100 rounded-full flex items-center justify-center text-slate-400"><i data-lucide="x" class="w-4 h-4"></i></button>
            </div>
            <!-- Content -->
            <div class="p-6">
                <h2 id="detail-title" class="text-lg font-bold text-slate-900 leading-snug mb-2"></h2>
                <div class="flex items-center gap-2 text-slate-500 text-xs font-medium mb-6">
                    <i data-lucide="calendar" class="w-3.5 h-3.5 text-slate-400"></i>
                    <span id="detail-date"></span>
                </div>
                <div>
                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1.5 flex items-center gap-1"><i data-lucide="edit-2" class="w-3 h-3"></i> Açıklama</label>
                    <div id="detail-notes" class="p-3 bg-slate-50 rounded-xl text-sm text-slate-700 leading-relaxed border border-slate-100 min-h-[80px]"></div>
                </div>
                <div class="mt-6 pt-4 border-t border-slate-50">
                    <button onclick="editCurrentPost()" class="w-full bg-slate-900 text-white py-2.5 rounded-xl font-semibold text-xs hover:bg-slate-800 transition-all flex items-center justify-center gap-2">
                        <i data-lucide="edit-2" class="w-3.5 h-3.5"></i> Düzenle
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- DAY DETAILS MODAL (Overflow) -->
    <div id="day-details-modal" class="fixed inset-0 z-[60] flex items-center justify-center p-4 hidden">
        <div onclick="closeDayDetails()" class="absolute inset-0 bg-black/20 backdrop-blur-sm"></div>
        <div class="bg-white rounded-2xl shadow-xl w-full max-w-sm relative z-10 overflow-hidden zoom-in">
            <div class="p-4 border-b border-slate-100 flex items-center justify-between bg-slate-50/50">
                <div>
                    <h3 id="day-modal-title" class="font-bold text-slate-900"></h3>
                    <span id="day-modal-subtitle" class="text-xs text-slate-500 font-medium"></span>
                </div>
                <button onclick="closeDayDetails()" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-200 text-slate-500"><i data-lucide="x" class="w-4 h-4"></i></button>
            </div>
            <div id="day-modal-list" class="p-2 max-h-[400px] overflow-y-auto flex flex-col gap-2">
                <!-- Posts insert here -->
            </div>
            <div class="p-3 border-t border-slate-100 bg-slate-50/30">
                <button onclick="addPostFromDayModal()" class="w-full py-2.5 rounded-xl bg-slate-900 text-white text-xs font-bold hover:bg-slate-800 transition-all">Yeni Plan Ekle</button>
            </div>
        </div>
    </div>

    <!-- SCRIPT LOGIC -->
    <script>
        // --- DATA & STATE ---
        const state = {
            currentDate: new Date(),
            view: 'calendar', // 'calendar' | 'media'
            posts: [
                { id: '1', title: 'Ürün Lansmanı Teaser', date: new Date(), platform: 'instagram', type: 'reel', notes: '#yeniurun #lansman', mediaUrl: 'https://images.unsplash.com/photo-1611162617474-5b21e879e113?q=80&w=300' },
                { id: '2', title: 'Blog Özeti', date: new Date(new Date().setDate(new Date().getDate() + 2)), platform: 'linkedin', type: 'post', notes: 'Şirket kültürü', mediaUrl: null },
                { id: '3', title: 'Youtube Vlog', date: new Date(), platform: 'youtube', type: 'video', notes: 'Vlog part 1', mediaUrl: null },
                { id: '4', title: 'Twitter Thread', date: new Date(), platform: 'twitter', type: 'post', notes: 'Flood', mediaUrl: null }
            ],
            editor: { isOpen: false, selectedDate: null, editingPostId: null },
            drag: { isSpacePressed: false, isDragging: false, startX: 0, startY: 0, scrollLeft: 0, scrollTop: 0 }
        };

        const monthNames = ["Ocak", "Şubat", "Mart", "Nisan", "Mayıs", "Haziran", "Temmuz", "Ağustos", "Eylül", "Ekim", "Kasım", "Aralık"];
        const weekdays = ["Pazar", "Pazartesi", "Salı", "Çarşamba", "Perşembe", "Cuma", "Cumartesi"];

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            renderCalendar();
            renderTimeline();
            lucide.createIcons();
            
            // Pan Events
            const container = document.getElementById('calendar-container');
            
            window.addEventListener('keydown', (e) => {
                if(e.code === 'Space' && e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
                    e.preventDefault();
                    state.drag.isSpacePressed = true;
                    container.classList.add('cursor-grab');
                    document.getElementById('pan-indicator').classList.remove('hidden');
                }
            });
            
            window.addEventListener('keyup', (e) => {
                if(e.code === 'Space') {
                    state.drag.isSpacePressed = false;
                    state.drag.isDragging = false;
                    container.classList.remove('cursor-grab', '!cursor-grabbing');
                    document.getElementById('pan-indicator').classList.add('hidden');
                }
            });

            container.addEventListener('mousedown', (e) => {
                if(state.drag.isSpacePressed) {
                    state.drag.isDragging = true;
                    container.classList.add('!cursor-grabbing');
                    state.drag.startX = e.clientX;
                    state.drag.startY = e.clientY;
                    state.drag.scrollLeft = container.scrollLeft;
                    state.drag.scrollTop = container.scrollTop;
                    e.preventDefault();
                }
            });

            container.addEventListener('mousemove', (e) => {
                if(state.drag.isDragging) {
                    const dx = e.clientX - state.drag.startX;
                    const dy = e.clientY - state.drag.startY;
                    
                    // Vertical Swipe -> Month Change
                    if (Math.abs(dy) > 150) {
                        changeMonth(dy > 0 ? -1 : 1);
                        state.drag.isDragging = false;
                        return;
                    }

                    container.scrollLeft = state.drag.scrollLeft - dx;
                    container.scrollTop = state.drag.scrollTop - dy;
                }
            });

            container.addEventListener('mouseup', () => state.drag.isDragging = false);
            container.addEventListener('mouseleave', () => state.drag.isDragging = false);
        });

        // --- RENDER LOGIC ---

        function renderCalendar() {
            const year = state.currentDate.getFullYear();
            const month = state.currentDate.getMonth();
            
            document.getElementById('calendar-month-year').innerHTML = `${monthNames[month]} <span class="text-slate-400 font-light">${year}</span>`;

            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const prevMonthLastDay = new Date(year, month, 0).getDate();
            
            // Adjust start day (Monday=0 in UI grid logic, but Date.getDay Sunday=0)
            let startDayIndex = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1;

            const grid = document.getElementById('calendar-grid');
            grid.innerHTML = '';

            const today = new Date();
            today.setHours(0,0,0,0);

            // Previous Month Fillers
            for (let i = startDayIndex; i > 0; i--) {
                const d = new Date(year, month - 1, prevMonthLastDay - i + 1);
                grid.appendChild(createDayCell(d, false));
            }

            // Current Month
            for (let i = 1; i <= lastDay.getDate(); i++) {
                const d = new Date(year, month, i);
                grid.appendChild(createDayCell(d, true));
            }

            // Next Month Fillers
            const currentCells = grid.children.length;
            const remaining = 42 - currentCells;
            for (let i = 1; i <= remaining; i++) {
                const d = new Date(year, month + 1, i);
                grid.appendChild(createDayCell(d, false));
            }
            
            lucide.createIcons();
        }

        function createDayCell(date, isCurrentMonth) {
            const cell = document.createElement('div');
            const isToday = isSameDay(date, new Date());
            const isPast = date < new Date().setHours(0,0,0,0);

            let classes = "relative p-2 flex flex-col border-b border-r border-slate-200 h-full min-h-[140px] group transition-colors ";
            
            if (isPast && !isToday) {
                classes += "day-past bg-slate-50 ";
                if (!isCurrentMonth) classes += "opacity-40 ";
            } else {
                classes += "bg-white hover:bg-slate-50 ";
                if (!isCurrentMonth) classes += "bg-slate-50/30 text-slate-300 ";
            }
            
            cell.className = classes;
            cell.onclick = () => { if(!state.drag.isSpacePressed) openEditor(date); };

            // Day Number
            let numClass = "text-[14px] font-medium w-8 h-8 flex items-center justify-center rounded-full mb-1 ";
            if (isToday) numClass += "bg-blue-600 text-white shadow-md shadow-blue-200";
            else if (!isCurrentMonth) numClass += "text-slate-300";
            else numClass += "text-slate-700";

            // Posts
            const dayPosts = state.posts.filter(p => isSameDay(new Date(p.date), date));
            const visiblePosts = dayPosts.slice(0, 3);
            const remaining = dayPosts.length - 3;

            let postsHtml = visiblePosts.map(post => `
                <div onclick="openPostDetail('${post.id}', event)" class="py-1.5 px-2 rounded-md text-[11px] transition-all cursor-pointer flex items-center gap-2 border bg-white border-slate-100 shadow-sm text-slate-700 hover:border-blue-300 hover:text-blue-600 mb-1">
                    <div class="w-1.5 h-1.5 rounded-full flex-shrink-0 ${getPlatformColorBg(post.platform)}"></div>
                    <span class="truncate font-medium leading-tight">${post.title}</span>
                </div>
            `).join('');

            if (remaining > 0) {
                postsHtml += `
                    <button onclick="openDayDetails('${date.toISOString()}', event)" class="text-[10px] font-semibold text-slate-400 hover:text-blue-600 text-left px-1 mt-auto flex items-center gap-1">
                        <i data-lucide="more-horizontal" class="w-3 h-3"></i> ${remaining} tane daha...
                    </button>
                `;
            }

            // Hover Add Button (Only current month or today)
            const addButton = (isCurrentMonth && (!isPast || isToday)) ? `
                <div class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-all transform scale-90 group-hover:scale-100 z-10">
                    <button onclick="event.stopPropagation(); openEditor(new Date('${date.toISOString()}'))" class="w-6 h-6 flex items-center justify-center bg-blue-600 text-white rounded-full shadow-md hover:bg-blue-700">
                        <i data-lucide="plus" class="w-3.5 h-3.5"></i>
                    </button>
                </div>
            ` : '';

            cell.innerHTML = `
                <div class="flex justify-between items-start">
                    <span class="${numClass}">${date.getDate()}</span>
                    ${isToday ? '<span class="text-[10px] font-bold text-blue-600 mt-2 mr-2">Bugün</span>' : ''}
                </div>
                <div class="flex flex-col flex-1 mt-1">${postsHtml}</div>
                ${addButton}
            `;
            return cell;
        }

        function renderTimeline() {
            const container = document.getElementById('timeline-scroll-area');
            const today = new Date(); today.setHours(0,0,0,0);
            
            // Filter future posts
            const upcoming = state.posts.filter(p => new Date(p.date) >= today).sort((a,b) => new Date(a.date) - new Date(b.date));
            document.getElementById('timeline-count').innerText = upcoming.length;

            // Group by Date
            const groups = {};
            upcoming.forEach(p => {
                const dKey = new Date(p.date).toLocaleDateString('tr-TR', {day: 'numeric', month: 'long'});
                if(!groups[dKey]) groups[dKey] = [];
                groups[dKey].push(p);
            });

            let html = '';
            for (const [dateLabel, posts] of Object.entries(groups)) {
                const isTodayStr = new Date().toLocaleDateString('tr-TR', {day: 'numeric', month: 'long'}) === dateLabel;
                
                html += `
                    <div class="flex flex-col gap-3 flex-shrink-0">
                        <div class="flex items-center gap-2 px-1">
                            <div class="w-1.5 h-1.5 rounded-full ${isTodayStr ? 'bg-green-500' : 'bg-slate-300'}"></div>
                            <span class="text-[11px] font-bold uppercase tracking-widest ${isTodayStr ? 'text-green-600' : 'text-slate-400'}">${isTodayStr ? 'BUGÜN' : dateLabel}</span>
                        </div>
                        <div class="flex gap-3">
                `;
                
                posts.forEach(p => {
                    html += `
                        <div onclick="openPostDetail('${p.id}', event)" class="w-56 bg-white border border-slate-200 rounded-2xl p-3 hover:shadow-xl hover:-translate-y-1 transition-all cursor-pointer group flex-shrink-0 relative">
                            <div class="flex items-start gap-3">
                                <div class="w-10 h-10 rounded-lg bg-slate-50 overflow-hidden flex-shrink-0 relative border border-slate-100">
                                    ${p.mediaUrl ? `<img src="${p.mediaUrl}" class="w-full h-full object-cover">` : '<div class="w-full h-full flex items-center justify-center text-slate-300"><i data-lucide="calendar" class="w-4 h-4"></i></div>'}
                                </div>
                                <div class="flex-1 overflow-hidden">
                                    <div class="flex items-center justify-between mb-1">
                                        <span class="text-[9px] font-bold text-slate-400">${new Date(p.date).toLocaleTimeString('tr-TR', {hour:'2-digit', minute:'2-digit'})}</span>
                                        <i data-lucide="${getPlatformIconName(p.platform)}" class="w-3.5 h-3.5 ${getPlatformColorText(p.platform)}"></i>
                                    </div>
                                    <h4 class="text-[11px] font-bold text-slate-700 truncate">${p.title}</h4>
                                </div>
                            </div>
                        </div>
                    `;
                });
                html += `</div></div>`;
            }

            // Add Button at end
            html += `
                <div class="flex-shrink-0 flex items-center h-[90px] mt-6">
                    <button onclick="openEditor(new Date())" class="flex flex-col items-center justify-center w-20 h-20 border border-dashed border-slate-300 rounded-2xl text-slate-400 hover:border-blue-400 hover:bg-blue-50 hover:text-blue-600 transition-all">
                        <i data-lucide="plus" class="w-6 h-6"></i>
                        <span class="text-[9px] font-bold mt-1 uppercase">Yeni</span>
                    </button>
                </div>
            `;

            container.innerHTML = html;
            lucide.createIcons();
        }

        function renderMediaLibrary() {
            const grid = document.getElementById('media-grid');
            const mediaPosts = state.posts.filter(p => p.mediaUrl);
            
            grid.innerHTML = mediaPosts.map(p => `
                <div onclick="openPostDetail('${p.id}', event)" class="group relative aspect-square rounded-xl overflow-hidden shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all cursor-pointer bg-white border border-slate-100">
                    <img src="${p.mediaUrl}" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent opacity-0 group-hover:opacity-100 transition-all flex flex-col justify-end p-3">
                        <span class="text-white text-[10px] font-bold truncate">${p.title}</span>
                    </div>
                </div>
            `).join('');
        }

        // --- ACTIONS & MODALS ---

        function switchView(viewName) {
            state.view = viewName;
            const calBtn = document.getElementById('btn-view-calendar');
            const mediaBtn = document.getElementById('btn-view-media');
            const calView = document.getElementById('view-calendar');
            const mediaView = document.getElementById('view-media');
            const timeline = document.getElementById('bottom-timeline');

            if (viewName === 'calendar') {
                calBtn.className = "flex items-center gap-2 px-6 py-2 rounded-full text-xs font-bold transition-all bg-white shadow-sm text-slate-900";
                mediaBtn.className = "flex items-center gap-2 px-6 py-2 rounded-full text-xs font-bold transition-all text-slate-500 hover:text-slate-700";
                calView.classList.remove('hidden');
                mediaView.classList.add('hidden');
                timeline.classList.remove('hidden');
            } else {
                calBtn.className = "flex items-center gap-2 px-6 py-2 rounded-full text-xs font-bold transition-all text-slate-500 hover:text-slate-700";
                mediaBtn.className = "flex items-center gap-2 px-6 py-2 rounded-full text-xs font-bold transition-all bg-white shadow-sm text-slate-900";
                calView.classList.add('hidden');
                mediaView.classList.remove('hidden');
                timeline.classList.add('hidden');
                renderMediaLibrary();
            }
        }

        function changeMonth(inc) {
            state.currentDate.setMonth(state.currentDate.getMonth() + inc);
            renderCalendar();
        }

        function toggleTimeline() {
            const t = document.getElementById('bottom-timeline');
            const icon = document.getElementById('timeline-icon');
            if (t.classList.contains('h-52')) {
                t.classList.replace('h-52', 'h-10');
                icon.setAttribute('data-lucide', 'chevron-up');
            } else {
                t.classList.replace('h-10', 'h-52');
                icon.setAttribute('data-lucide', 'chevron-down');
            }
            lucide.createIcons();
        }

        // --- EDITOR LOGIC ---
        let currentFormData = { platform: 'instagram', type: 'post', media: null };

        function openEditor(date, post = null) {
            state.editor.isOpen = true;
            state.editor.selectedDate = new Date(date);
            
            const overlay = document.getElementById('editor-overlay');
            const panel = document.getElementById('editor-panel');
            overlay.classList.remove('hidden');
            setTimeout(() => overlay.classList.remove('opacity-0'), 10);
            panel.classList.remove('translate-x-full');

            // Reset or Fill Form
            if (post) {
                state.editor.editingPostId = post.id;
                document.getElementById('editor-title').innerText = 'Gönderiyi Düzenle';
                document.getElementById('input-title').value = post.title;
                document.getElementById('input-notes').value = post.notes || '';
                selectPlatform(post.platform);
                selectType(post.type);
                if(post.mediaUrl) setPreview(post.mediaUrl); else removeMedia();
                document.getElementById('save-btn-text').innerText = "Güncelle";
            } else {
                state.editor.editingPostId = null;
                document.getElementById('editor-title').innerText = 'Yeni Planla';
                document.getElementById('input-title').value = '';
                document.getElementById('input-notes').value = '';
                selectPlatform('instagram');
                selectType('post');
                removeMedia();
                document.getElementById('save-btn-text').innerText = "Kaydet & Planla";
            }
            
            document.getElementById('editor-date').innerText = new Date(date).toLocaleDateString('tr-TR', {weekday:'long', day:'numeric', month:'long'});
        }

        function closeEditor() {
            const overlay = document.getElementById('editor-overlay');
            const panel = document.getElementById('editor-panel');
            overlay.classList.add('opacity-0');
            panel.classList.add('translate-x-full');
            setTimeout(() => overlay.classList.add('hidden'), 300);
            state.editor.isOpen = false;
        }

        function selectPlatform(p) {
            currentFormData.platform = p;
            document.querySelectorAll('.plat-btn').forEach(b => {
                b.className = "plat-btn p-3 rounded-xl border-2 border-slate-100 bg-white flex flex-col items-center gap-1 hover:bg-slate-50 text-slate-500";
            });
            const active = document.getElementById('plat-'+p);
            active.className = "plat-btn p-3 rounded-xl border-2 border-indigo-600 bg-indigo-50 text-indigo-700 flex flex-col items-center gap-1 shadow-sm transform scale-105 transition-all";
        }

        function selectType(t) {
            currentFormData.type = t;
            document.querySelectorAll('.type-btn').forEach(b => {
                b.className = "type-btn flex-1 py-2 rounded-lg text-xs font-bold flex items-center justify-center gap-1 text-slate-500 hover:text-slate-700";
            });
            const active = document.getElementById('type-'+t);
            active.className = "type-btn flex-1 py-2 rounded-lg text-xs font-bold flex items-center justify-center gap-1 bg-white text-indigo-700 shadow-sm";
        }

        function handleFileSelect(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => setPreview(e.target.result);
                reader.readAsDataURL(input.files[0]);
            }
        }

        function setPreview(url) {
            currentFormData.media = url;
            document.getElementById('media-placeholder').classList.add('hidden');
            const img = document.getElementById('media-img');
            img.src = url;
            img.classList.remove('hidden');
            document.getElementById('remove-media-btn').classList.remove('hidden');
            document.getElementById('media-preview-area').classList.add('h-64');
            document.getElementById('media-preview-area').classList.remove('h-32');
        }

        function removeMedia(e) {
            if(e) e.stopPropagation();
            currentFormData.media = null;
            document.getElementById('media-placeholder').classList.remove('hidden');
            document.getElementById('media-img').classList.add('hidden');
            document.getElementById('remove-media-btn').classList.add('hidden');
            document.getElementById('file-input').value = '';
            document.getElementById('media-preview-area').classList.remove('h-64');
            document.getElementById('media-preview-area').classList.add('h-32');
        }

        function savePost() {
            const title = document.getElementById('input-title').value;
            if(!title) { alert('Başlık gerekli'); return; }

            const newPost = {
                id: state.editor.editingPostId || Math.random().toString(36).substr(2, 9),
                title: title,
                date: state.editor.selectedDate,
                platform: currentFormData.platform,
                type: currentFormData.type,
                notes: document.getElementById('input-notes').value,
                mediaUrl: currentFormData.media
            };

            if (state.editor.editingPostId) {
                const idx = state.posts.findIndex(p => p.id === newPost.id);
                state.posts[idx] = newPost;
            } else {
                state.posts.push(newPost);
            }

            closeEditor();
            renderCalendar();
            renderTimeline();
            if(state.view === 'media') renderMediaLibrary();
        }

        // --- POST DETAIL MODAL ---
        let currentDetailPostId = null;

        function openPostDetail(id, e) {
            if(e) e.stopPropagation();
            const post = state.posts.find(p => p.id === id);
            if(!post) return;
            currentDetailPostId = id;

            document.getElementById('detail-title').innerText = post.title;
            document.getElementById('detail-date').innerText = new Date(post.date).toLocaleDateString('tr-TR', {day:'numeric', month:'long', weekday:'long', hour:'2-digit', minute:'2-digit'});
            document.getElementById('detail-notes').innerText = post.notes || 'Açıklama yok.';
            
            const pBadge = document.getElementById('detail-platform-badge');
            pBadge.innerText = post.platform;
            pBadge.className = `px-2.5 py-1 rounded-md text-[10px] font-bold tracking-wider uppercase border ${getPlatformColorClass(post.platform)}`;
            
            document.getElementById('detail-type-badge').innerText = post.type;

            document.getElementById('post-detail-modal').classList.remove('hidden');
        }

        function closePostDetail() {
            document.getElementById('post-detail-modal').classList.add('hidden');
        }

        function editCurrentPost() {
            const post = state.posts.find(p => p.id === currentDetailPostId);
            closePostDetail();
            // Close day modal if open
            closeDayDetails();
            openEditor(post.date, post);
        }

        // --- DAY DETAILS MODAL ---
        let currentDayModalDate = null;

        function openDayDetails(dateStr, e) {
            if(e) e.stopPropagation();
            const date = new Date(dateStr);
            currentDayModalDate = date;

            document.getElementById('day-modal-title').innerText = date.toLocaleDateString('tr-TR', {day:'numeric', month:'long'});
            document.getElementById('day-modal-subtitle').innerText = date.toLocaleDateString('tr-TR', {weekday:'long'});

            const dayPosts = state.posts.filter(p => isSameDay(new Date(p.date), date));
            const list = document.getElementById('day-modal-list');
            list.innerHTML = dayPosts.map(p => `
                <button onclick="openPostDetail('${p.id}', event)" class="flex items-center gap-3 p-3 rounded-xl hover:bg-slate-50 border border-transparent hover:border-slate-100 transition-all text-left group">
                    <div class="w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 ${getPlatformColorBg(p.platform)}/20 ${getPlatformColorText(p.platform)}">
                         <i data-lucide="${getPlatformIconName(p.platform)}" class="w-5 h-5"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                        <h4 class="text-sm font-semibold text-slate-900 truncate">${p.title}</h4>
                        <div class="flex items-center gap-2 mt-0.5">
                            <span class="text-[10px] uppercase font-bold text-slate-400 bg-slate-100 px-1.5 rounded">${p.platform}</span>
                            <span class="text-[10px] text-slate-400">${p.type}</span>
                        </div>
                    </div>
                </button>
            `).join('');

            document.getElementById('day-details-modal').classList.remove('hidden');
            lucide.createIcons();
        }

        function closeDayDetails() {
            document.getElementById('day-details-modal').classList.add('hidden');
        }

        function addPostFromDayModal() {
            closeDayDetails();
            openEditor(currentDayModalDate);
        }

        // --- HELPERS ---
        function isSameDay(d1, d2) {
            return d1.getDate() === d2.getDate() && d1.getMonth() === d2.getMonth() && d1.getFullYear() === d2.getFullYear();
        }

        function getPlatformColorClass(p) {
            if(p==='instagram') return 'bg-pink-50 text-pink-600 border-pink-100';
            if(p==='linkedin') return 'bg-blue-50 text-blue-600 border-blue-100';
            if(p==='twitter') return 'bg-sky-50 text-sky-600 border-sky-100';
            return 'bg-red-50 text-red-600 border-red-100';
        }
        function getPlatformColorBg(p) {
            if(p==='instagram') return 'bg-pink-500';
            if(p==='linkedin') return 'bg-blue-600';
            if(p==='twitter') return 'bg-sky-500';
            return 'bg-red-500';
        }
        function getPlatformColorText(p) {
            if(p==='instagram') return 'text-pink-600';
            if(p==='linkedin') return 'text-blue-600';
            if(p==='twitter') return 'text-sky-500';
            return 'text-red-600';
        }
        function getPlatformIconName(p) {
            if(p==='instagram') return 'instagram';
            if(p==='linkedin') return 'linkedin';
            if(p==='twitter') return 'twitter';
            return 'youtube';
        }

    </script>
</body>
</html>
