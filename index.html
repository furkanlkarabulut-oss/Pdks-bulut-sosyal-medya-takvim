<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SocialFlow Planner</title>
    
    <!-- Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons (Script Version) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        
        /* Özel Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* Animasyonlar */
        .animate-in { animation: fadeIn 0.3s ease-out forwards; }
        .slide-in-right { animation: slideInRight 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }
        @keyframes slideInRight { from { transform: translateX(100%); } to { transform: translateX(0); } }
        
        /* Glass Effect */
        .glass { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); }
        
        /* Input Reset */
        input:focus, textarea:focus { outline: none; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 overflow-hidden h-screen w-screen selection:bg-indigo-100 selection:text-indigo-900">

    <!-- Uygulama Kökü -->
    <div id="root" class="h-full w-full relative"></div>

    <script>
        // --- 1. VERİ VE DURUM YÖNETİMİ (STATE) ---
        
        const initialState = {
            user: null, // { firstName, lastName, role, initials }
            currentDate: new Date(),
            activeView: 'main', // 'main' (calendar) or 'media'
            activeFilter: 'all',
            
            // UI State
            isEditorOpen: false,
            viewPostId: null,
            selectedDate: null,
            editingPostId: null,
            
            // Editör Formu
            editorForm: {
                title: '',
                notes: '',
                platform: 'instagram',
                type: 'post',
                status: 'idea',
                hashtags: '',
                adConfig: { isActive: false, budget: 100, duration: 3 },
                mediaUrl: null,
                comments: [] 
            },

            // Başlangıç Verileri
            posts: [
                {
                    id: '1',
                    title: 'Ürün Lansmanı Teaser',
                    date: new Date(), 
                    platform: 'instagram',
                    type: 'reels',
                    status: 'pending',
                    notes: 'Yeni sezon ürünlerimizin ilk tanıtımı.',
                    hashtags: '#yeniurun #lansman #moda2024',
                    mediaUrl: 'https://images.unsplash.com/photo-1611162617474-5b21e879e113?q=80&w=1000&auto=format&fit=crop',
                    author: 'Patron Yönetici',
                    comments: [{ author: 'İçerik Editörü', text: 'Taslağı hazırladım.' }],
                    adConfig: { isActive: true, budget: 500, duration: 3 }
                },
                {
                    id: '2',
                    title: 'Haftalık Blog Özeti',
                    date: new Date(new Date().setDate(new Date().getDate() + 2)), 
                    platform: 'linkedin',
                    type: 'post',
                    status: 'idea',
                    notes: 'Şirket kültürü hakkında yazı paylaşımı.',
                    author: 'İçerik Editörü',
                    comments: [],
                    adConfig: { isActive: false, budget: 0, duration: 0 },
                    mediaUrl: 'https://images.unsplash.com/photo-1497215728101-856f4ea42174?q=80&w=1000&auto=format&fit=crop'
                }
            ]
        };

        // State Proxy (React benzeri reaktivite)
        const state = new Proxy(initialState, {
            set(target, property, value) {
                target[property] = value;
                render(); // Her değişiklikte ekranı yenile
                return true;
            }
        });

        // --- 2. FONKSİYONLAR (ACTIONS) ---

        // Giriş İşlemi
        function login(firstName, lastName, role) {
            if(!firstName.trim() || !lastName.trim()) return alert("Lütfen isim ve soyisim giriniz.");
            state.user = { 
                firstName, 
                lastName, 
                role, 
                initials: (firstName[0] + lastName[0]).toUpperCase() 
            };
        }

        // Editör Açma
        function openEditor(date = new Date(), post = null) {
            state.selectedDate = date;
            state.editingPostId = post ? post.id : null;
            
            if (post) {
                // Mevcut postu deep copy ile al
                state.editorForm = JSON.parse(JSON.stringify(post));
                // Tarih stringe dönüşürse düzelt
                state.editorForm.date = new Date(state.editorForm.date);
            } else {
                // Yeni post formu
                state.editorForm = {
                    title: '',
                    notes: '',
                    platform: 'instagram',
                    type: 'post',
                    status: 'idea',
                    hashtags: '',
                    adConfig: { isActive: false, budget: 100, duration: 3 },
                    mediaUrl: null,
                    comments: []
                };
            }
            state.isEditorOpen = true;
        }

        function closeEditor() {
            state.isEditorOpen = false;
        }

        // Post Kaydetme
        function savePost() {
            const form = state.editorForm;
            if(!form.title) form.title = "Başlıksız Plan";

            const newPost = {
                ...form,
                id: state.editingPostId || Math.random().toString(36).substr(2, 9),
                date: state.editingPostId ? new Date(form.date) : new Date(state.selectedDate),
                author: state.editingPostId ? form.author : `${state.user.firstName} ${state.user.lastName}`
            };

            if (state.editingPostId) {
                state.posts = state.posts.map(p => p.id === newPost.id ? newPost : p);
            } else {
                state.posts = [...state.posts, newPost];
            }
            closeEditor();
            state.viewPostId = null; // Detay açıksa kapat
        }

        // Post Silme
        function deletePost(id) {
            if(confirm("Bu içeriği silmek istediğinize emin misiniz?")) {
                state.posts = state.posts.filter(p => p.id !== id);
                state.viewPostId = null;
                state.isEditorOpen = false;
                render(); 
            }
        }

        // Reklam Durumu Değiştirme
        function toggleAdStatus(postId) {
            state.posts = state.posts.map(p => {
                if(p.id === postId && p.adConfig) {
                    return { ...p, adConfig: { ...p.adConfig, isActive: !p.adConfig.isActive } };
                }
                return p;
            });
        }

        // Detay Görüntüleme
        function openPostDetail(id) {
            state.viewPostId = id;
        }

        function closePostDetail() {
            state.viewPostId = null;
        }
        
        // Ay Değiştirme
        function changeMonth(increment) {
            const newDate = new Date(state.currentDate);
            newDate.setMonth(newDate.getMonth() + increment);
            state.currentDate = newDate;
        }

        // --- 3. RENDERING ENGINE (React Yerine) ---

        const root = document.getElementById('root');

        function render() {
            root.innerHTML = ''; // Temizle
            
            if (!state.user) {
                root.appendChild(renderLoginPanel());
            } else {
                root.appendChild(renderAppLayout());
            }
            
            // İkonları oluştur
            lucide.createIcons();
        }

        // --- BİLEŞENLER (HTML String Döndüren Fonksiyonlar) ---

        // 1. GİRİŞ PANELİ
        function renderLoginPanel() {
            const div = document.createElement('div');
            div.className = "fixed inset-0 flex items-center justify-center bg-slate-50";
            div.innerHTML = `
                <div class="absolute inset-0 overflow-hidden">
                     <div class="absolute -top-[20%] -left-[10%] w-[50%] h-[50%] rounded-full bg-blue-200/30 blur-3xl"></div>
                     <div class="absolute top-[40%] -right-[10%] w-[40%] h-[60%] rounded-full bg-indigo-200/30 blur-3xl"></div>
                </div>

                <div class="bg-white/90 backdrop-blur-xl p-10 rounded-[32px] shadow-2xl w-full max-w-4xl border border-white/50 relative z-10 animate-in flex flex-col md:flex-row gap-10 items-center">
                    
                    <div class="flex-1 w-full space-y-6">
                        <div class="text-left">
                            <div class="w-12 h-12 bg-slate-900 text-white rounded-xl flex items-center justify-center mb-4 shadow-lg shadow-slate-200">
                                <i data-lucide="sparkles" width="24"></i>
                            </div>
                            <h1 class="text-3xl font-bold text-slate-900 tracking-tight mb-2">SocialFlow</h1>
                            <p class="text-slate-500 text-sm font-medium leading-relaxed">
                                Sosyal medya içeriklerinizi planlayın, yönetin ve analiz edin.
                            </p>
                        </div>

                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-[11px] font-bold text-slate-400 uppercase mb-2 ml-1">Adınız</label>
                                    <input type="text" id="loginName" class="w-full bg-slate-50 border border-slate-200 p-4 rounded-2xl text-slate-900 font-bold focus:ring-2 focus:ring-indigo-100 focus:border-indigo-500 transition-all" placeholder="Ad">
                                </div>
                                <div>
                                    <label class="block text-[11px] font-bold text-slate-400 uppercase mb-2 ml-1">Soyadınız</label>
                                    <input type="text" id="loginSurname" class="w-full bg-slate-50 border border-slate-200 p-4 rounded-2xl text-slate-900 font-bold focus:ring-2 focus:ring-indigo-100 focus:border-indigo-500 transition-all" placeholder="Soyad">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="hidden md:block w-px h-64 bg-slate-100"></div>

                    <div class="flex-1 w-full space-y-4">
                        <label class="block text-[11px] font-bold text-slate-400 uppercase mb-2">Giriş Yapılacak Rol</label>
                        
                        <button onclick="window.attemptLogin('admin')" class="w-full group relative border rounded-2xl p-5 text-left transition-all duration-300 bg-white border-slate-200 hover:border-indigo-500 hover:ring-1 hover:ring-indigo-500 hover:-translate-y-1 shadow-sm">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 rounded-xl flex items-center justify-center bg-indigo-50 text-indigo-600 group-hover:bg-indigo-600 group-hover:text-white transition-colors shrink-0">
                                    <i data-lucide="shield-check" width="24"></i>
                                </div>
                                <div>
                                    <h3 class="text-base font-bold text-slate-900 group-hover:text-indigo-600 transition-colors">Yönetici / Patron</h3>
                                    <p class="text-xs text-slate-400 mt-1">Tam yetkili erişim.</p>
                                </div>
                            </div>
                        </button>

                        <button onclick="window.attemptLogin('editor')" class="w-full group relative border rounded-2xl p-5 text-left transition-all duration-300 bg-white border-slate-200 hover:border-pink-500 hover:ring-1 hover:ring-pink-500 hover:-translate-y-1 shadow-sm">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 rounded-xl flex items-center justify-center bg-pink-50 text-pink-600 group-hover:bg-pink-600 group-hover:text-white transition-colors shrink-0">
                                    <i data-lucide="edit-3" width="24"></i>
                                </div>
                                <div>
                                    <h3 class="text-base font-bold text-slate-900 group-hover:text-pink-600 transition-colors">İçerik Editörü</h3>
                                    <p class="text-xs text-slate-400 mt-1">İçerik üretimi ve planlama.</p>
                                </div>
                            </div>
                        </button>
                    </div>
                </div>
            `;
            
            window.attemptLogin = (role) => {
                const first = document.getElementById('loginName').value;
                const last = document.getElementById('loginSurname').value;
                login(first, last, role);
            };

            return div;
        }

        // 2. ANA TASARIM (SIDEBAR + MAIN)
        function renderAppLayout() {
            const container = document.createElement('div');
            container.className = "flex h-full bg-white";

            // Sidebar HTML
            const sidebarHTML = `
                <div class="w-20 border-r border-slate-200 flex flex-col items-center py-6 z-20 bg-white">
                    <div class="w-10 h-10 ${state.user.role === 'admin' ? 'bg-indigo-900' : 'bg-pink-600'} rounded-xl text-white flex items-center justify-center font-bold mb-8 shadow-lg shadow-indigo-200">
                        ${state.user.initials}
                    </div>
                    <nav class="flex flex-col gap-4 w-full px-2">
                        <button onclick="state.activeView = 'main'; render();" class="p-3 rounded-xl ${state.activeView === 'main' ? 'bg-slate-100 text-slate-900' : 'text-slate-400 hover:bg-slate-50 hover:text-slate-600'} transition-all"><i data-lucide="calendar" width="20"></i></button>
                        <button onclick="state.activeView = 'media'; render();" class="p-3 rounded-xl ${state.activeView === 'media' ? 'bg-slate-100 text-slate-900' : 'text-slate-400 hover:bg-slate-50 hover:text-slate-600'} transition-all"><i data-lucide="image" width="20"></i></button>
                    </nav>
                </div>
            `;

            // Main Content Area
            const main = document.createElement('main');
            main.className = "flex-1 relative bg-slate-50/30 overflow-hidden flex flex-col";
            
            // Header
            const headerHTML = `
                <header class="h-16 border-b border-slate-200 bg-white flex items-center justify-between px-6 z-30 shrink-0">
                    <div class="flex items-center gap-3">
                        <div class="flex flex-col">
                            <span class="font-bold text-sm text-slate-900 leading-none">${state.user.firstName} ${state.user.lastName}</span>
                            <span class="text-[10px] text-slate-500 font-medium mt-0.5 uppercase tracking-wide">
                                ${state.user.role === 'admin' ? 'Yönetici' : 'İçerik Editörü'}
                            </span>
                        </div>
                    </div>
                    <button onclick="window.openEditor(new Date())" class="bg-slate-900 text-white hover:bg-slate-800 transition-colors px-4 py-2 rounded-lg text-sm font-semibold flex items-center gap-2 shadow-sm">
                        <i data-lucide="plus" width="16"></i> Yeni Plan
                    </button>
                </header>
            `;
            
            // Content Body
            let contentBody;
            if (state.activeView === 'main') {
                contentBody = renderCalendar();
            } else {
                contentBody = renderMediaLibrary();
            }

            container.innerHTML = sidebarHTML;
            main.innerHTML = headerHTML;
            main.appendChild(contentBody);
            container.appendChild(main);

            // Modallar
            if (state.isEditorOpen) container.appendChild(renderRightPanel());
            if (state.viewPostId) container.appendChild(renderPostModal());

            // Global fonksiyonlar
            window.openEditor = openEditor;
            window.changeMonth = changeMonth;

            return container;
        }

        // 3. TAKVİM GÖRÜNÜMÜ
        function renderCalendar() {
            const div = document.createElement('div');
            div.className = "flex-1 flex flex-col h-full overflow-hidden bg-white select-none relative";

            const year = state.currentDate.getFullYear();
            const month = state.currentDate.getMonth();
            const monthNames = ["Ocak", "Şubat", "Mart", "Nisan", "Mayıs", "Haziran", "Temmuz", "Ağustos", "Eylül", "Ekim", "Kasım", "Aralık"];
            
            const firstDay = new Date(year, month, 1).getDay(); // 0 Pazar
            const offset = firstDay === 0 ? 6 : firstDay - 1; 
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            let gridHTML = `
                <div class="flex items-center justify-between px-8 py-6 z-20 bg-white border-b border-slate-100">
                    <div class="flex items-center gap-4">
                        <h2 class="text-2xl font-bold text-slate-900 tracking-tight">
                            ${monthNames[month]} <span class="text-slate-400 font-light">${year}</span>
                        </h2>
                        <div class="flex items-center gap-1 bg-slate-100 p-1 rounded-full">
                            <button onclick="window.changeMonth(-1)" class="w-8 h-8 flex items-center justify-center hover:bg-white rounded-full transition-all text-slate-500"><i data-lucide="chevron-left" width="18"></i></button>
                            <button onclick="window.changeMonth(1)" class="w-8 h-8 flex items-center justify-center hover:bg-white rounded-full transition-all text-slate-500"><i data-lucide="chevron-right" width="18"></i></button>
                        </div>
                    </div>
                </div>
                <div class="flex-1 overflow-auto p-8 flex flex-col">
                    <div class="grid grid-cols-7 mb-2">
                        ${['Pzt', 'Sal', 'Çar', 'Per', 'Cum', 'Cmt', 'Paz'].map(d => `<div class="text-center pb-2 text-[12px] font-bold text-slate-400 uppercase tracking-widest">${d}</div>`).join('')}
                    </div>
                    <div class="grid grid-cols-7 grid-rows-5 flex-1 border-t border-l border-slate-200 min-h-[600px]">
            `;

            // Boşluklar
            for(let i=0; i<offset; i++) {
                gridHTML += `<div class="bg-slate-50/50 border-b border-r border-slate-200"></div>`;
            }

            // Günler
            const today = new Date();
            for(let i=1; i<=daysInMonth; i++) {
                const date = new Date(year, month, i);
                const isToday = date.toDateString() === today.toDateString();
                const dayPosts = state.posts.filter(p => new Date(p.date).toDateString() === date.toDateString());

                gridHTML += `
                    <div onclick="window.openEditor(new Date('${date}'))" class="group relative p-2 flex flex-col border-b border-r border-slate-200 transition-colors h-full min-h-[120px] ${isToday ? 'bg-indigo-50/10 ring-2 ring-indigo-600 ring-inset z-10' : 'bg-white hover:bg-slate-50'} cursor-pointer">
                        <div class="flex justify-between items-start mb-1">
                            <span class="text-[14px] font-medium w-8 h-8 flex items-center justify-center rounded-full ${isToday ? 'bg-indigo-600 text-white shadow-md' : 'text-slate-700'}">${i}</span>
                            ${isToday ? '<span class="text-[10px] font-bold text-indigo-600 mt-2 mr-2 uppercase">Bugün</span>' : ''}
                        </div>
                        <div class="flex flex-col gap-1.5 flex-1 mt-1">
                            ${dayPosts.slice(0, 3).map(post => `
                                <div onclick="event.stopPropagation(); window.openPostDetail('${post.id}')" class="py-1.5 px-2 rounded-md text-[10px] transition-all cursor-pointer flex items-center gap-2 border pr-1 shadow-sm hover:shadow-md bg-white border-slate-200 text-slate-700">
                                    <div class="w-1.5 h-1.5 rounded-full flex-shrink-0 ${getStatusColor(post.status)}"></div>
                                    <span class="truncate font-semibold leading-tight flex-1 tracking-tight">${post.title}</span>
                                </div>
                            `).join('')}
                            ${dayPosts.length > 3 ? `<span class="text-[10px] text-slate-400 font-bold px-1">+${dayPosts.length - 3} daha</span>` : ''}
                        </div>
                         <div class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-all transform scale-90 group-hover:scale-100 z-10">
                            <button class="w-6 h-6 flex items-center justify-center bg-indigo-600 text-white rounded-full shadow-md hover:bg-indigo-700 transition-colors">
                                <i data-lucide="plus" width="14"></i>
                            </button>
                        </div>
                    </div>
                `;
            }

            gridHTML += `</div></div>`;
            div.innerHTML = gridHTML;
            
            // Global erişim
            window.openPostDetail = openPostDetail;

            return div;
        }

        // 4. MEDYA GALERİSİ
        function renderMediaLibrary() {
            const div = document.createElement('div');
            div.className = "p-8 h-full overflow-y-auto bg-slate-50/50 animate-in";
            
            const mediaPosts = state.posts.filter(p => p.mediaUrl);
            
            div.innerHTML = `
                <div class="flex items-center justify-between mb-8">
                    <h2 class="text-2xl font-bold text-slate-900 flex items-center gap-3">
                        <div class="p-2 bg-indigo-100 rounded-lg text-indigo-600"><i data-lucide="image" width="20"></i></div>
                        Medya Arşivi
                    </h2>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                    ${mediaPosts.map(post => `
                        <div onclick="window.openPostDetail('${post.id}')" class="group relative aspect-square rounded-xl overflow-hidden shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all cursor-pointer bg-white border border-slate-100">
                            <img src="${post.mediaUrl}" alt="${post.title}" class="w-full h-full object-cover" />
                            <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent opacity-0 group-hover:opacity-100 transition-all flex flex-col justify-end p-3">
                                <span class="text-white text-[10px] font-bold truncate">${post.title}</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            return div;
        }

        // 5. SAĞ PANEL (EDİTÖR) - Apple Stil
        function renderRightPanel() {
            const overlay = document.createElement('div');
            overlay.className = "fixed inset-0 z-50 flex justify-end";
            overlay.innerHTML = `
                <div onclick="window.closeEditor()" class="absolute inset-0 bg-slate-900/20 backdrop-blur-sm"></div>
                <div class="w-[550px] bg-white/95 backdrop-blur-xl h-[96vh] my-[2vh] rounded-l-[32px] shadow-2xl flex flex-col relative z-50 animate-in slide-in-right duration-300 font-sans border-l border-white/50 overflow-hidden ring-1 ring-black/5 right-0 mr-0">
                    
                    <!-- Header -->
                    <div class="pt-6 px-8 pb-4 flex items-center justify-between shrink-0 z-10">
                        <button onclick="window.closeEditor()" class="w-8 h-8 rounded-full bg-slate-100 hover:bg-slate-200 flex items-center justify-center text-slate-500 transition-colors">
                            <i data-lucide="x" width="18"></i>
                        </button>
                        
                        <div class="flex items-center gap-3">
                            <span class="text-xs font-semibold text-slate-400 bg-slate-50 px-3 py-1 rounded-full border border-slate-100">
                                ${new Date(state.selectedDate).toLocaleDateString('tr-TR')}
                            </span>
                            ${state.editingPostId ? `
                                <button onclick="window.deletePost('${state.editingPostId}')" class="w-8 h-8 rounded-full bg-red-50 text-red-500 hover:bg-red-100 flex items-center justify-center transition-colors">
                                    <i data-lucide="trash-2" width="16"></i>
                                </button>
                            ` : ''}
                        </div>
                    </div>

                    <!-- Scrollable Body -->
                    <div class="flex-1 overflow-y-auto px-8 py-2">
                        
                        <!-- Başlık ve İçerik -->
                        <div class="mb-6 space-y-3">
                            <div>
                                <label class="text-[11px] font-bold text-slate-500 uppercase tracking-wider mb-1.5 block">Başlık</label>
                                <input type="text" id="editTitle" value="${state.editorForm.title}" class="w-full text-base font-semibold text-slate-900 placeholder-slate-300 outline-none bg-white border border-slate-200 rounded-xl px-4 py-3 focus:border-slate-400 focus:ring-4 focus:ring-slate-100 transition-all shadow-sm" placeholder="İçerik başlığı...">
                            </div>

                            <div>
                                <label class="text-[11px] font-bold text-slate-500 uppercase tracking-wider mb-1.5 block">İçerik Metni</label>
                                <textarea id="editNotes" rows="6" class="w-full bg-white border border-slate-200 rounded-xl p-4 text-sm leading-relaxed text-slate-800 placeholder-slate-400 outline-none focus:border-slate-400 focus:ring-4 focus:ring-slate-100 transition-all resize-none shadow-sm" placeholder="Gönderi metni ve notlarınız...">${state.editorForm.notes || ''}</textarea>
                            </div>
                        </div>

                        <!-- Platform Seçimi -->
                        <div class="flex gap-4 mb-6">
                            <div class="relative group">
                                <button onclick="window.togglePlatformMenu()" class="h-full flex flex-col items-center justify-center gap-1 px-4 py-3 bg-white border border-slate-200 rounded-xl hover:bg-slate-50 transition-all min-w-[80px]">
                                    <div class="p-1.5 rounded-lg ${state.editorForm.platform === 'instagram' ? 'text-pink-600' : 'text-blue-600'}">
                                        <i data-lucide="${state.editorForm.platform === 'instagram' ? 'instagram' : state.editorForm.platform === 'twitter' ? 'twitter' : state.editorForm.platform === 'linkedin' ? 'linkedin' : 'youtube'}" width="18"></i>
                                    </div>
                                    <span class="text-[10px] font-bold text-slate-600 capitalize">${state.editorForm.platform}</span>
                                </button>
                                
                                <div id="platformMenu" class="hidden absolute top-full left-0 mt-2 bg-white border border-slate-200 rounded-xl shadow-xl z-20 p-1.5 grid-cols-1 w-40 animate-in">
                                     ${['instagram', 'linkedin', 'twitter', 'youtube'].map(p => `
                                         <button onclick="window.updateForm('platform', '${p}'); window.togglePlatformMenu()" class="flex items-center gap-3 p-2 rounded-lg text-xs font-bold w-full text-left hover:bg-slate-50 text-slate-500">
                                            <span class="capitalize">${p}</span>
                                         </button>
                                     `).join('')}
                                </div>
                            </div>

                            <div class="flex-1 bg-slate-100 p-1 rounded-xl flex items-center">
                                ${['post', 'reels', 'story'].map(t => `
                                    <button onclick="window.updateForm('type', '${t}')" class="flex-1 h-full rounded-lg text-[11px] font-bold capitalize transition-all duration-300 flex items-center justify-center gap-1.5 ${state.editorForm.type === t ? 'bg-white text-black shadow-sm' : 'text-slate-400 hover:text-slate-600'}">
                                        ${t}
                                    </button>
                                `).join('')}
                            </div>
                        </div>

                         <!-- Medya Yükleme (Basitleştirilmiş) -->
                         <div class="mb-6">
                            <div class="relative w-full rounded-2xl transition-all group overflow-hidden border-2 border-dashed ${state.editorForm.mediaUrl ? 'h-auto border-transparent shadow-sm' : 'h-32 border-slate-200 bg-slate-50 hover:bg-slate-100 cursor-pointer'}">
                                ${state.editorForm.mediaUrl ? `
                                    <img src="${state.editorForm.mediaUrl}" class="w-full h-auto object-cover block rounded-2xl" />
                                    <button onclick="window.updateForm('mediaUrl', null)" class="absolute top-3 right-3 bg-white/90 p-2 rounded-full text-red-500 shadow-sm"><i data-lucide="trash-2" width="16"></i></button>
                                ` : `
                                    <div onclick="document.getElementById('fileInput').click()" class="h-full flex flex-col items-center justify-center text-slate-400 gap-2">
                                        <i data-lucide="upload" width="20"></i>
                                        <span class="text-xs font-bold text-slate-400">Görsel Yükle (Demo)</span>
                                    </div>
                                `}
                            </div>
                            <input type="file" id="fileInput" class="hidden" onchange="window.handleFileSelect(this)">
                        </div>

                        <!-- Reklam Alanı -->
                        <div class="mb-6 rounded-xl border transition-all duration-300 overflow-hidden ${state.editorForm.adConfig.isActive ? 'bg-white border-indigo-200 shadow-md ring-1 ring-indigo-50' : 'bg-white border-slate-200'}">
                            <div class="flex items-center justify-between p-3 min-h-[50px]">
                                <div class="flex items-center gap-3">
                                    <div class="p-1.5 rounded-md ${state.editorForm.adConfig.isActive ? 'bg-indigo-600 text-white' : 'bg-slate-100 text-slate-400'}">
                                        <i data-lucide="megaphone" width="16"></i>
                                    </div>
                                    <span class="font-bold text-xs ${state.editorForm.adConfig.isActive ? 'text-indigo-900' : 'text-slate-500'}">Reklam Desteği</span>
                                </div>
                                <button onclick="window.toggleAdForm()" class="w-10 h-6 rounded-full relative transition-colors duration-300 ${state.editorForm.adConfig.isActive ? 'bg-indigo-600' : 'bg-slate-200'}">
                                    <div class="absolute top-1 left-1 bg-white w-4 h-4 rounded-full shadow-sm transition-transform duration-300 ${state.editorForm.adConfig.isActive ? 'translate-x-4' : 'translate-x-0'}"></div>
                                </button>
                            </div>
                            
                            ${state.editorForm.adConfig.isActive ? `
                                <div class="px-4 pb-4 pt-1 grid grid-cols-2 gap-4 animate-in">
                                     <div>
                                         <label class="text-[10px] text-slate-500 font-bold uppercase block mb-1.5">Bütçe (TL)</label>
                                         <input type="number" value="${state.editorForm.adConfig.budget}" onchange="window.updateAd('budget', this.value)" class="w-full bg-white border border-slate-300 rounded-xl p-2.5 font-bold text-slate-900 outline-none text-sm focus:border-indigo-500">
                                         <div class="flex gap-1 mt-2">
                                            <button onclick="window.updateAd('budget', 200)" class="flex-1 bg-indigo-50 text-indigo-700 text-[10px] font-bold py-1 rounded">200₺</button>
                                            <button onclick="window.updateAd('budget', 500)" class="flex-1 bg-indigo-50 text-indigo-700 text-[10px] font-bold py-1 rounded">500₺</button>
                                         </div>
                                     </div>
                                     <div>
                                         <label class="text-[10px] text-slate-500 font-bold uppercase block mb-1.5">Süre (Gün)</label>
                                         <input type="number" value="${state.editorForm.adConfig.duration}" onchange="window.updateAd('duration', this.value)" class="w-full bg-white border border-slate-300 rounded-xl p-2.5 font-bold text-slate-900 outline-none text-sm focus:border-indigo-500">
                                          <div class="flex gap-1 mt-2">
                                            <button onclick="window.updateAd('duration', 3)" class="flex-1 bg-indigo-50 text-indigo-700 text-[10px] font-bold py-1 rounded">3G</button>
                                            <button onclick="window.updateAd('duration', 7)" class="flex-1 bg-indigo-50 text-indigo-700 text-[10px] font-bold py-1 rounded">7G</button>
                                         </div>
                                     </div>
                                </div>
                            ` : ''}
                        </div>

                        <!-- Hashtags -->
                        <div class="mb-6">
                            <label class="text-[11px] font-bold text-slate-500 uppercase tracking-wider mb-2 block flex items-center gap-1">
                                <i data-lucide="hash" width="12"></i> Hashtagler
                            </label>
                            <div class="bg-white rounded-xl p-1 flex items-start border border-slate-200 focus-within:border-indigo-300 focus-within:ring-4 focus-within:ring-indigo-50 transition-all">
                                <span class="p-3 text-slate-400"><i data-lucide="hash" width="14"></i></span>
                                <textarea id="editHashtags" rows="2" class="w-full bg-transparent p-3 pl-0 text-sm text-indigo-600 font-medium outline-none resize-none placeholder-slate-300" placeholder="tbt, pazartesi...">${state.editorForm.hashtags || ''}</textarea>
                            </div>
                        </div>

                        <!-- Revize -->
                        <div class="mb-24">
                            <h3 class="text-xs font-bold text-slate-900 mb-4 flex items-center gap-2 uppercase tracking-wide">
                                <i data-lucide="zap" width="14" class="text-amber-500 fill-amber-500"></i> Revize Talepleri
                            </h3>
                            <div class="space-y-4 mb-4">
                                ${state.editorForm.comments.length ? state.editorForm.comments.map(c => `
                                    <div class="flex gap-3 text-sm">
                                        <div class="w-8 h-8 rounded-full bg-slate-900 text-white flex items-center justify-center text-[10px] font-bold shadow-md shadow-slate-200">
                                            ${c.author.substring(0,2).toUpperCase()}
                                        </div>
                                        <div class="bg-white p-3 rounded-2xl rounded-tl-none border border-slate-200 flex-1 shadow-sm">
                                            <span class="text-[11px] font-bold text-slate-900 block mb-1">${c.author}</span>
                                            <p class="text-slate-600 leading-relaxed text-xs">${c.text}</p>
                                        </div>
                                    </div>
                                `).join('') : '<div class="text-center py-6 bg-slate-50 rounded-xl border border-dashed border-slate-200 text-slate-400 text-xs italic">Henüz bir revize talebi yok.</div>'}
                            </div>
                        </div>
                    </div>

                    <!-- Footer -->
                    <div class="absolute bottom-0 left-0 right-0 p-6 bg-white/90 backdrop-blur-md border-t border-slate-100">
                        <div class="flex gap-3 items-center">
                            <div class="relative w-1/2">
                                <button onclick="window.toggleStatusMenu()" class="flex items-center justify-between gap-2 px-4 py-3.5 rounded-xl text-xs font-bold transition-all w-full border shadow-sm ${getStatusStyle(state.editorForm.status)}">
                                    <div class="flex items-center gap-2">
                                        <div class="w-2 h-2 rounded-full bg-current"></div>
                                        <span class="capitalize">${state.editorForm.status}</span>
                                    </div>
                                    <i data-lucide="chevron-down" width="14" class="opacity-50"></i>
                                </button>
                                <div id="statusMenu" class="hidden absolute bottom-full left-0 mb-2 w-full bg-white border border-slate-100 rounded-xl shadow-xl overflow-hidden p-1">
                                    ${['idea', 'draft', 'pending', 'revision', 'published'].map(s => `
                                        <button onclick="window.updateForm('status', '${s}'); window.toggleStatusMenu()" class="w-full text-left px-3 py-3 text-xs font-semibold text-slate-600 hover:bg-slate-50 rounded-lg flex items-center gap-2 capitalize">
                                            <div class="w-2 h-2 rounded-full ${getStatusStyle(s).split(' ')[0].replace('bg-','bg-')}"></div> ${s}
                                        </button>
                                    `).join('')}
                                </div>
                            </div>

                            <button onclick="window.submitForm()" class="w-1/2 bg-slate-900 text-white py-3.5 rounded-xl text-xs font-bold shadow-lg shadow-slate-200 hover:bg-slate-800 hover:scale-[1.02] active:scale-95 transition-all">
                                Kaydet
                            </button>
                        </div>
                    </div>
                </div>
            `;

            // Olay İşleyicileri
            window.closeEditor = closeEditor;
            window.deletePost = deletePost;
            
            window.updateForm = (field, value) => {
                state.editorForm[field] = value;
                render(); 
            };
            
            window.togglePlatformMenu = () => {
                document.getElementById('platformMenu').classList.toggle('hidden');
            };
            
            window.toggleStatusMenu = () => {
                document.getElementById('statusMenu').classList.toggle('hidden');
            };

            window.toggleAdForm = () => {
                state.editorForm.adConfig.isActive = !state.editorForm.adConfig.isActive;
                render();
            };

            window.updateAd = (field, value) => {
                state.editorForm.adConfig[field] = Number(value);
                // Input değerini manuel güncelle render etmeden (focus kaybetmemek için)
                const inputs = overlay.querySelectorAll('input[type="number"]');
                // Basitlik için render çağırıyorum, vanilla JS optimizasyonu yapılabilir
                render();
            };
            
            window.handleFileSelect = (input) => {
                 if (input.files && input.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        window.updateForm('mediaUrl', e.target.result);
                    }
                    reader.readAsDataURL(input.files[0]);
                }
            };

            window.submitForm = () => {
                state.editorForm.title = document.getElementById('editTitle').value;
                state.editorForm.notes = document.getElementById('editNotes').value;
                state.editorForm.hashtags = document.getElementById('editHashtags').value;
                savePost();
            };
            
            overlay.querySelector('div:nth-child(2)').onclick = (e) => e.stopPropagation();

            return overlay;
        }

        // 6. DETAY MODAL
        function renderPostModal() {
            const post = state.posts.find(p => p.id === state.viewPostId);
            if(!post) return document.createElement('div');

            const div = document.createElement('div');
            div.className = "fixed inset-0 z-[60] flex items-center justify-center p-4";
            div.innerHTML = `
                <div onclick="window.closePostDetail()" class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm"></div>
                
                <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md relative z-10 overflow-visible animate-in border border-slate-100 flex flex-col max-h-[90vh]">
                    <!-- Header -->
                    <div class="flex items-center justify-between p-5 border-b border-slate-50 bg-slate-50/50 shrink-0 rounded-t-2xl">
                        <div class="flex items-center gap-2">
                             <span class="px-2.5 py-1 rounded-md text-[10px] font-bold tracking-wider uppercase border ${
                                 post.platform === 'instagram' ? 'bg-pink-50 text-pink-600 border-pink-100' : 'bg-blue-50 text-blue-600 border-blue-100'
                             }">${post.platform}</span>
                             <span class="text-[10px] font-semibold text-slate-400 uppercase bg-white border border-slate-200 px-2 py-1 rounded-md">${post.type}</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <button onclick="window.deletePost('${post.id}')" class="w-8 h-8 hover:bg-red-50 rounded-full flex items-center justify-center text-slate-300 hover:text-red-500 transition-all"><i data-lucide="trash-2" width="16"></i></button>
                            <button onclick="window.closePostDetail()" class="w-8 h-8 hover:bg-slate-100 rounded-full flex items-center justify-center text-slate-400"><i data-lucide="x" width="18"></i></button>
                        </div>
                    </div>

                    <!-- Content -->
                    <div class="p-6 overflow-y-auto">
                        <h2 class="text-xl font-bold text-slate-900 leading-snug mb-2">${post.title}</h2>
                        
                        <div class="flex items-center gap-2 text-slate-500 text-xs font-medium mb-6">
                             <i data-lucide="calendar" width="14"></i>
                             <span>${new Date(post.date).toLocaleDateString('tr-TR', { day: 'numeric', month: 'long' })}</span>
                        </div>

                        ${post.mediaUrl ? `
                            <div class="mb-6 rounded-xl overflow-hidden border border-slate-100 bg-slate-50">
                                <img src="${post.mediaUrl}" class="w-full h-auto object-contain" />
                            </div>
                        ` : ''}
                        
                        <div class="p-4 bg-slate-50 rounded-xl text-sm text-slate-700 leading-relaxed border border-slate-100 mb-4">
                            ${post.notes || '<span class="text-slate-400 italic">Açıklama girilmemiş.</span>'}
                        </div>

                        ${post.hashtags ? `
                             <div class="flex gap-2 items-start text-indigo-600 text-xs font-medium bg-indigo-50 p-3 rounded-lg border border-indigo-100 mb-4">
                                <i data-lucide="hash" width="14" class="mt-0.5 shrink-0"></i>
                                <p>${post.hashtags}</p>
                            </div>
                        ` : ''}

                         ${post.adConfig && post.adConfig.isActive ? `
                            <div class="flex items-center justify-between p-3 bg-green-50 border border-green-100 rounded-xl mb-4">
                                <div class="flex items-center gap-2">
                                    <div class="p-1.5 bg-green-100 text-green-600 rounded-full"><i data-lucide="megaphone" width="14"></i></div>
                                    <div class="text-xs">
                                        <div class="font-bold text-green-800">Reklam Aktif</div>
                                        <div class="text-green-600">${post.adConfig.budget}₺ • ${post.adConfig.duration} Gün</div>
                                    </div>
                                </div>
                                <button onclick="window.toggleAdStatus('${post.id}'); window.render();" class="text-[10px] font-bold bg-white border border-green-200 text-green-700 px-2 py-1 rounded hover:bg-green-100">Durdur</button>
                            </div>
                        ` : ''}

                        <button onclick="window.openEditor(new Date('${post.date}'), state.posts.find(p => p.id === '${post.id}')); window.closePostDetail();" class="w-full bg-slate-900 text-white py-3 rounded-xl font-bold text-sm shadow-lg hover:bg-slate-800 transition-all mt-4">
                            Düzenle
                        </button>
                    </div>
                </div>
            `;
            
            window.closePostDetail = closePostDetail;
            window.toggleAdStatus = toggleAdStatus;

            return div;
        }

        // --- YARDIMCI FONKSİYONLAR ---
        function getStatusColor(s) {
            switch(s) {
                case 'idea': return 'bg-slate-300';
                case 'draft': return 'bg-blue-400';
                case 'pending': return 'bg-orange-400';
                case 'published': return 'bg-green-500';
                default: return 'bg-slate-300';
            }
        }
        
        function getStatusStyle(s) {
             switch(s) {
                case 'idea': return 'bg-slate-100 text-slate-600 border-slate-200';
                case 'draft': return 'bg-blue-50 text-blue-700 border-blue-200';
                case 'pending': return 'bg-orange-50 text-orange-700 border-orange-200';
                case 'revision': return 'bg-red-50 text-red-700 border-red-200';
                case 'published': return 'bg-green-50 text-green-700 border-green-200';
                default: return 'bg-slate-100 text-slate-800';
            }
        }

        // --- UYGULAMAYI BAŞLAT ---
        render();

    </script>
</body>
</html>
